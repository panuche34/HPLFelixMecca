class TableGr{constructor(n){this._table=null;this._tableId="";this._objCols=null;this._isUseCacheLoadTime=!0;this._defineTypesDate=[];this.create(n)}adjust(n){n||(n=1e3);setTimeout(()=>{this._table.columns.adjust()},n)}create(n){let t=null;if(n=$.extend({serverSide:!1,processing:!1,changeCallBack:null,onAjaxSuccessCallBack:null,visibleFirstColumn:!1,isSelect:!1,searching:!0,paging:!0,initComplete:null,info:!0,bFilter:!1,bLengthChange:!1,autoWidth:!0,scrollX:!0,isUseCache:!0,cacheForSession:!1,language:{sSearch:""},columnDefs:[{targets:[0],visible:n.visibleFirstColumn},{targets:[0],orderable:!1},{targets:[0],className:n.visibleFirstColumn?"dt-center":"dt-left"},{targets:[1],orderable:n.visibleFirstColumn},{targets:[1],className:n.visibleFirstColumn?"dt-left":"dt-center"}],success:()=>{t.draw()},infoCallback:function(i,r,u,f,e){return n.changeCallBack!=null&&e>0&&n.changeCallBack(t),`${r} de ${u} de ${f}`}},n),this._tableId=n.idTable,n.columns===undefined){const i=document.querySelector(`#${this._tableId}`),r=i.querySelectorAll("th"),t=[];for(const n of r){const i=n.getAttribute("property");if(i!=null){t.push({data:i});const r=n.getAttribute("property-type");r!=null&&this._defineTypesDate.push({prop:i,type:r})}}n.columns=t}n.isSelect&&(n.select={style:"single"});let i=function(n){return n!==undefined&&new _notifyGr(n.responseText,"danger"),""};n.onAjaxErrorCallback!==undefined&&n.onAjaxErrorCallback!==""&&(i=onAjaxErrorCallback);n.endPointList!==undefined&&n.endPointList!==""&&(n.ajax=n.serverSide===!0?{url:n.endPointList,type:"POST",data:t=>{const r=new FormValues;let i=null;if(n.isUseCache&&this._isUseCacheLoadTime){const t=n.cacheForSession?this._getSearchToSessionStorage():this._getSearchToLocalStorage();t==null?i=(new FormValues).get("form-filter"):(r.set("form-filter",t),i=t);this._isUseCacheLoadTime=!1}else i=(new FormValues).get("form-filter");r.appPropTo(i,t);n.isUseCache&&(n.cacheForSession?this._setSearchToSessionStorage(t):this._setSearchToLocalStorage(t))},dataFilter:function(t){if(n.onAjaxSuccessCallBack!=null){var i=jQuery.parseJSON(t);n.onAjaxSuccessCallBack(i.footerInfo)}return t},error:i}:{url:n.endPointList,headers:{"X-XSRF-TOKEN":getCookie("obras.mayaragallo.com.br")},error:i,dataSrc:""});n.dataSet!==undefined&&n.dataSet!==null&&(n.data=dataSet);n.buttons!==undefined&&n.buttons!==null&&(n.dom="Bfrtip",n.buttons=buttons);this._table=$(`#${this._tableId}`).DataTable(n);t=this._table}table(){return this._table}add(n){this._setColsObj();(new FormValues).copyTo(n,this._objCols);this._table.row.add(this._objCols).draw();let t=this._table;setTimeout(function(){t.columns.adjust().draw()},1e3)}addAll(n){this._setColsObj();for(const t of n)(new FormValues).copyTo(t,this._objCols),this._table.row.add(this._objCols).draw();let t=this._table;setTimeout(function(){t.columns.adjust().draw()},1e3)}reload(){this._table.ajax.reload()}remove(){this._table.rows(idxToReplace).remove();let n=this._table;setTimeout(function(){n.columns.adjust().draw()},1e3)}removeAll(){this._table.clear().draw();let n=this._table;setTimeout(function(){n.columns.adjust().draw()},1e3)}replace(n,t){this._setColsObj();(new FormValues).copyTo(t,this._objCols);this._formatColsValues();this._table.rows(n).remove();this._table.row.add(this._objCols).draw();let i=this._table;setTimeout(function(){i.columns.adjust().draw()},1e3)}replaceAll(n){this._setColsObj();for(const t of n)(new FormValues).copyTo(t,this._objCols),this._table.rows(idxToReplace).remove(),this._table.row.add(this._objCols).draw();let t=this._table;setTimeout(function(){t.columns.adjust().draw()},1e3)}_formatColsValues(){for(const n in this._objCols){const t=this._defineTypesDate.find(t=>t.prop==n);if(t)switch(t.type){case"date":const t=new Date(this._objCols[n]),i=t.toLocaleString("pt-BR",{year:"numeric",month:"2-digit",day:"2-digit"});this._objCols[n]=i;break;case"datetime":const r=new Date(this._objCols[n]),u=r.toLocaleString("pt-BR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});this._objCols[n]=u}}}_setColsObj(){if(this._objCols==null){const n=this._table.columns().header();this._objCols={};n.each(n=>{const t=n.getAttribute("property");t!==null&&(this._objCols[t]=null,t==="Buttons"&&(this._objCols[t]=_BTN_EDIT+_BTN_DELETE))})}}_getSearchToLocalStorage(){const n=`${this._tableId.toUpperCase()}_SEARCH`;if(!localStorage.getItem(n))return null;const t=localStorage.getItem(n);if(t=="")return null;let i=JSON.parse(t);return i===undefined?null:i}_setSearchToLocalStorage(n){localStorage.setItem(`${this._tableId.toUpperCase()}_SEARCH`,JSON.stringify(n))}_getSearchToSessionStorage(){const n=`${this._tableId.toUpperCase()}_SEARCH`;if(!sessionStorage.getItem(n))return null;const t=sessionStorage.getItem(n);if(t=="")return null;let i=JSON.parse(t);return i===undefined?null:i}_setSearchToSessionStorage(n){sessionStorage.setItem(`${this._tableId.toUpperCase()}_SEARCH`,JSON.stringify(n))}getSelectedAllData(){let n=this._table.rows(".selected").data()[0];return n||(n=[],this._table.rows().every(function(){var t=$(this.node()).find('input[type="checkbox"]');t.is(":checked")&&n.push(this.data())})),n}}